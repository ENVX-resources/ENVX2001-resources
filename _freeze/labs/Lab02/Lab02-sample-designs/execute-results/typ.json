{
  "hash": "c0703fff954d4db57b4032c2b1dfd98b",
  "result": {
    "engine": "knitr",
    "markdown": "---\n# title: '[L]{style=\"color:crimson;\"}[a]{style=\"color:blue;\"}[b]{style=\"color:darkgoldenrod;\"} 02'\ntitle: Lab 02\n# revised-by:\nsubtitle: ENVX2001 Applied Statistical Methods\ndescription: The University of Sydney\ndate: today\ndate-format: \"[Semester 1,] YYYY\"\n---\n\n{{< pagebreak >}}\n\n::: callout-tip\n## LEARNING OUTCOMES\n\nAt the end of this practical students should be able to:\n\n-   explain conceptually the benefits of re-sampling (or not) the same units for monitoring studies.\n-   use R to create rudimentary sampling designs;\n-   estimate means and associated CIs for simple random designs;\n-   estimate means and associated CIs for stratified random designs;\n-   use R for estimating the change in means (and associated CIs) for monitoring schemes when the sample units are (i) resampled (ii) not resampled.\n:::\n\n\n## Exercise 1 -- Soil carbon (walk-through) {style=\"color:navy;\"}\n\nKarunaratne et al. (2012)^1^ measured soil carbon (%) in the Coxâ€™s creek catchment in northern NSW using a stratified random sampling scheme. The results are summarised below.\n\n-  **USE** is the land use type;\n-  **N** is the number of samples collected;\n-  **MEAN** is the mean soil carbon content;\n-  **VARIANCE** is the variance of the mean;\n-  **PERCENT_AREA** is the percentage of the catchment area represented by each land use type.\n\n::: column-margin\n^1^Karunaratne S. B., Bishop T. F. A., Odeh I. O. A., Baldock J. A., Marchant B. P. (2014) Estimating change in soil organic carbon using legacy data as the baseline: issues, approaches and lessons to learn. *Soil Research* **52**, 349-365.\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|use              |  n| mean| variance| percent_area|\n|:----------------|--:|----:|--------:|------------:|\n|Forest           |  9| 0.65|      1.4|           20|\n|Dryland Cropping | 14| 0.96|      0.4|           35|\n|Pasture-Vertosol | 14| 1.06|      0.8|           35|\n|Pasture-Other    |  2| 1.31|      0.4|            6|\n|Irrigated        |  5| 0.78|      0.8|            4|\n|Overall          | 44| 0.92|      1.0|          100|\n\n\n:::\n:::\n\n\nRecall that the confidence interval for the mean is an effective way to communicate the precision of the estimates (how well we know the true mean), and is derived from the standard error of the mean.\n\n\n### Calculating the 95% confidence interval of the mean {style=\"color:navy;\"}\n\n\nThe *weighted* mean ($y_s$) and variance ($Var(\\bar y_s)$) of the mean for a stratified random sample are given by:\n\n::: column-margin\n\nWeighted mean:\n\n1. Calculate mean value per stratum\n2. Multiply each mean value by the weight of the stratum\n3. Sum the weighted mean values to get the overall mean\n:::\n\n$$\\bar y_s = \\sum_{i=1}^L \\bar y_i \\times w_i$$\n\n\n\nwhere $L$ is the number of strata, $\\bar y_i$ is the mean of stratum $i$, and $w_i$ is the weight of stratum $i$, and\n\n::: column-margin\n\nWeighted variance of the mean:\n\n1. Calculate the variance of the mean for each stratum\n2. Multiply the variance of the mean by the **square** of the weight of the stratum\n3. Sum all the weighted variances to get the overall variance of the mean\n:::\n\n$$Var(\\bar y_s) = \\sum_{i=1}^L w_i^2 \\times Var(\\bar y_i)$$\n\n\nwhere $Var(\\bar y_i)$ is the variance of the mean for stratum $i$.\n\nWe can then calculate the 95% CI for the mean:\n\n::: column-margin\n\n95% CI for the mean:\n\n- Weighted mean **plus** (t-critical value $\\times$ standard error of the mean)\n- Weighted mean **minus** (t-critical value $\\times$ standard error of the mean)\n:::\n\n$$95\\% CI = \\bar y_s \\pm t^{0.025}_{n-L} \\times \\sqrt{Var(\\bar y_s)}$$\n\n\nwhere $L$ = number of strata, $n$ = total number of samples, $t^{0.025}_{n-L}$ is the t-critical value for the 95% CI and $\\sqrt{Var(\\bar y_s)}$ is the variance of the mean for the stratified random sample.\n\nIs stratified random sampling a good idea for this study? Let's find out.\n\n::: callout-important\n**Understanding how to calculate the 95% CI using summary statistics is examinable**. If you find it difficult to understand the mathematical notation, it might be easier to rewrite them in your own words -- for example, see the side notes.\n:::\n\n### Doing the calculations in R {style=\"color:navy;\"}\n\nThe data is provided below. The first is the `stratified` dataset, which contains the mean and variance of the soil carbon content for each land use type. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nstratified <- data.frame(\n    use = c(\n        \"Forest\", \"Dryland Cropping\", \"Pasture-Vertosol\", \"Pasture-Other\",\n        \"Irrigated\"\n    ),\n    n = c(9, 14, 14, 2, 5),\n    mean = c(0.65, 0.96, 1.06, 1.31, 0.78),\n    variance = c(1.4, 0.4, 0.8, 0.4, 0.8),\n    percent_area = c(20, 35, 35, 6, 4)\n)\n```\n:::\n\n\nYou should copy and paste this data into your own document and run `stratified` to view the data.\n\nLook at the code and see if you can understand how a data frame is created in R. The `data.frame` function is used to create a data frame, and the `c` function is used to create vectors of data. Each vector forms a column in the data frame.\n\n::: {.question}\n### Question 1\n\nEstimate the mean and associated 95% CI assuming **stratified** random sampling using the `carbon` dataset. We can use the `weighted.mean` function to calculate the weighted mean, and the `qt` function to calculate the t-critical value for a 95% CI. You should find out what these functions do by seeking their help documentation using the `?` operator.\n\n```r\n?weighted.mean\n?qt\n```\n\n\n::: column-margin\nTip: you can manipulate the object and subset specific rows, columns or cells using `$` and `[]` respectively. For example, to access the `mean` column of the `carbon` dataset, you can use `carbon$mean`. To access the mean value for the `Forest` stratum, you can use `carbon$mean[1]`.\n:::\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::: {.ans}\n### Solution 1\n\nFirst calculate each of weighted mean, the t-critical value for a 95% CI, and the standard error of the mean:\n\n::: {.cell}\n\n```{.r .cell-code}\n# Weighted mean:\nweighted_mean <- weighted.mean(stratified$mean, stratified$percent_area)\n\n# t-crit value for a 95% CI\ndegrees_freedom <- sum(stratified$n) - nrow(stratified)\ntcrit <- qt(0.975, df = degrees_freedom)\n\n# SE of the mean: variance/n * weight^2\nweight <- stratified$percent_area / 100\nweighted_var_mean <- stratified$variance / stratified$n * weight^2\nSE_mean <- sqrt(sum(weighted_var_mean))\nSE_mean\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1330347\n```\n\n\n:::\n:::\n\n\nThen we can calculate the 95% CI:\n\n::: {.cell}\n\n```{.r .cell-code}\n# 95% CI\nci_stratified <- c(\n    mean = weighted_mean,\n    L95 = weighted_mean - (tcrit * SE_mean),\n    U95 = weighted_mean + (tcrit * SE_mean)\n)\n\nci_stratified\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    mean      L95      U95 \n0.946800 0.677712 1.215888 \n```\n\n\n:::\n:::\n\n\nAbove, the results are combined into a single vector object `ci_stratified` which contains the mean and the lower (L95) and upper (U95) bounds of the 95% CI.\n\n-- **End of Solution 1** --\n:::\n:::\n\n## Exercise 2 - Soil carbon: what if...?\n\n***What if the authors had used simple random sampling?*** Below is the data object `overall` which contains the overall mean and variance of the soil carbon content for the entire catchment. It is also the last row of the table above.\n\n```r\noverall <- data.frame(\n    use = \"Overall\",\n    n = 44,\n    mean = 0.92,\n    variance = 1,\n    percent_area = 100\n)\n```\n\n\nCalculating the 95% CI for the mean using simple random sampling is similar to the stratified random sampling. The only difference is that the variance of the mean is calculated using the overall variance and sample size.\n\n$$Var(\\bar y) = \\frac{Var(y)}{n}$$\n\nwhere $Var(y)$ is the variance of the entire dataset and $n$ is the total number of samples.\n\nThus the 95% CI for the mean is:\n\n$$95\\% CI = \\bar y \\pm t^{0.025}_{n-1} \\times \\sqrt{Var(\\bar y)}$$\n\nwhere $n$ is the total number of samples, and $t^{0.025}_{n-1}$ is the t-critical value for the 95% CI.\n\n::: {.question}\n### Question 2\n\nEstimate the mean and associated 95% CI assuming **simple random sampling** using the `overall` dataset.\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::: {.ans}\n### Solution 2\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Mean value is already given\n# Calculate the variance of the mean\nvar_mean <- overall$variance / overall$n\n\n# Determine the t-critical value for a 95% confidence interval\ntcrit <- qt(0.975, df = overall$n - 1)\n\n# Calculate the confidence interval\nci_overall <- c(\n    mean = overall$mean,\n    L95 = overall$mean - tcrit * sqrt(var_mean),\n    U95 = overall$mean + tcrit * sqrt(var_mean)\n)\n\nci_overall\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     mean       L95       U95 \n0.9200000 0.6159722 1.2240278 \n```\n\n\n:::\n:::\n\n\n-- **End of Solution 2** --\n:::\n:::\n\n\n::: {.question}\n### Question 3\n\nWould you recommend stratified random sampling for future surveys? Provide evidence from the results of questions 2 and 3.\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::: {.ans}\n### Solution 3\n\nYes, the 95% CI is smaller, albeit marginally when stratified random sampling is adopted.\nAnother metric is the efficiency of stratification which is:\n\n$$\\frac{Var\\left(\\overline{y}_{SiR}\\right)}{Var\\left(\\overline{y}_{StR}\\right)}=\\frac{0.02273}{0.01770}=1.28$$\n\nor, in R:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(var_mean) / sum(weighted_var_mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.284156\n```\n\n\n:::\n:::\n\n \n\nThe results show that stratified random sampling is 1.28 times more efficient than simple random sampling. This means that to achieve the same level of precision, simple random sampling would require approximately 1.28 times more samples than stratified random sampling. So to achieve the same precision with simple random sampling, we would need approximately $1.28 * 44 = 57$ samples.\n\n-- **End of Solution 3** --\n:::\n:::\n\n## Exercise 3 - Kangaroos\n\n### Should we return to the same locations?\n\nIn this exercise we will explore the impact that resampling the locations has on the precision (width of the 95% CI) with which we estimate the change in mean between 2 surveys. We will also show the equivalence of this to 2-sample t-tests.\n\nThe key equation for estimating the variance of the change in mean is:\n\n$$Var (\\Delta\\bar{y}) = \n  Var (\\Delta\\bar{y}_2) + \n  Var (\\Delta\\bar{y}_1) - \n  2 \\times Cov(y_1, y_2) $$\n\nwhere:\n\n-   $Var (\\Delta\\bar{y})$ is the variance of the change in mean between 2 surveys;\n-   $Var (\\Delta\\bar{y}_2)$ is the variance of the mean for the 1st survey (baseline);\n-   $Var (\\Delta\\bar{y}_1)$ is the variance of the mean for the 2nd survey (repeat);\n-   $Cov(y_1, y_2)$ is the covariance between the means of the 2 surveys.\n\nWhen we resample the same locations, we include the covariance term which describes the relationship between the observations in the 2 surveys. If resample at **different locations** we assume the **covariance is equal to 0**, that is:\n\n$$ Var (\\Delta\\bar{y}) = Var (\\Delta\\bar{y}_2) + Var (\\Delta\\bar{y}_1) $$\n\nIn this exercise we will consider a study where kangaroos (number/km^2^) were counted in a woodland in an initial survey, and then 2 years later. The data is below.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t5 obs. of  2 variables:\n $ baseline: num  4 2 6 1 3\n $ rerun   : num  12 11 13 14 9\n```\n\n\n:::\n:::\n\n\nCan you generate a `data.frame` object from the output above? Try it yourself first, and then click on show the code below to see the answer (Note: PDF output will not hide the answer).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nbaseline <- c(4, 2, 6, 1, 3)\nrerun <- c(12, 11, 13, 14, 9)\nkangaroos <- data.frame(baseline, rerun)\n```\n:::\n\n\n::: {.question}\n### Question 4\nIntuitively, what would be the impact on the precison with which we estimate the mean when:\n\n(a) we resample the same locations in the repeat survey?\n(b) we sample at different locations in the repeat survey?\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::: {.ans}\n### Solution 4\n\n(a) When we resample the same locations, we include the covariance term which describes the relationship between the observations in the 2 surveys. This will reduce the variance of the change in mean, and hence the 95% CI will be narrower.\n(b) When we sample at different locations, we assume the covariance is equal to 0. This will increase the variance of the change in mean, and hence the 95% CI will be wider.\n\nTherefore, intuitively we should always sample at the same location for both surveys, but whether we do or not will depend on the experimental design and the research question!\n\n-- **End of Solution 4** --\n:::\n:::\n\n### Different locations\n\nLet's assume that the resampled locations are completely different from the baseline survey. This means that the covariance term is equal to 0. \n\n::: {.question}\n### Question 5\n\nUse R to estimate the 95% CI for the change in mean between the 2 surveys. The equation is:\n\n$$95\\%\\ CI=\\Delta\\left(\\bar{y}\\right)\\pm t_{df}^{0.025}\\times\\sqrt{Var\\left(\\Delta\\bar{y}\\right)}$$\n\nYou will need to calculate ${Var}\\left(\\Delta\\left(\\bar{y}_1\\right)\\right)$, $Var\\left(\\Delta\\left(\\bar{y}_2\\right)\\right)$, and $Cov\\left(\\bar{y}_1,\\bar{y}_2\\right)$.\n\nAs a starting point R script for calculating the covariance and variance for the **observations** is below, as is the code to calculate the t critical value ($t_{df}^{0.025}$). When we sample at different locations between surveys: $$df = n_{1}+ n_{2} - 2 = 5 + 5 - 2 = 8$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# If you want to isolate data from the two sampling periods:\nt0 <- kangaroos$baseline\nt2 <- kangaroos$rerun\n\n# NOTE: functions below are not assigned to objects.\n# To calculate covariance:\ncov(t0, t2)\n\n# To calculate variances:\nvar(t0)\nvar(t2)\n\n# t-critical value for a 95% CI with 8 degrees of freedom:\nqt(0.975, 8)\n```\n:::\n\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::: {.ans}\n### Solution 5\n\nSince we sample different locations in the repeat survey the covariance is equal to 0. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Assign the  data to objects t0 and t2\nt0 <- kangaroos$baseline\nt2 <- kangaroos$rerun\n\n# Calculate the critical value for a 95% confidence interval using the t-distribution with 8 degrees of freedom\ntcrit1 <- qt(0.975, 8)\n\n# Calculate the mean difference between t2 and t0\ndelta_mean <- mean(t2) - mean(t0)\n\n# Calculate the variance of t2 and t0 and divide by their respective sample sizes\nV_delta_mean <- var(t2) / length(t2) + var(t0) / length(t0)\n\n# Calculate the lower bound of the 95% confidence interval\nL95 <- delta_mean - tcrit1 * sqrt(V_delta_mean)\n\n# Calculate the upper bound of the 95% confidence interval\nU95 <- delta_mean + tcrit1 * sqrt(V_delta_mean)\n\n\nc(mean = delta_mean, L95 = L95, U95 = U95)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     mean       L95       U95 \n 8.600000  5.794625 11.405375 \n```\n\n\n:::\n:::\n\n\nTherefore the mean change is 8.6 and the 95% CI is [5.79,11.41].\n\n-- **End of Solution 5** --\n\n:::\n:::\n\n### Same locations\n\nNow let's assume that the resampled locations are the same as the baseline survey. This means that the covariance term is *not* equal to 0.\n\n::: {.question}\n### Question 6\n\nAssuming we resampled the **same locations** as the baseline survey, use R to estimate the 95% CI for the change in mean between the 2 surveys.\n\n::: column-margin\nNote: when we sample at same locations between surveys the *df* = number of paired sites - 1 = 5 - 1 = 4.\n:::\n\nHint: the following formulae are used:\n\n$$\\Delta \\bar y = \\bar y_2 - \\bar y_1$$ $$Var(\\Delta \\bar y) = Var( \\bar y_2) + Var( \\bar y_1) - 2 \\times Cov(\\bar y_1, \\bar y_2)$$\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::: {.ans}\n### Solution 6\n\nSince we sample at the same locations we have to include the covariance term. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntcrit2 <- qt(0.975, 4)\ndelta_mean <- mean(t2) - mean(t0)\nV_delta_mean <- var(t2) / length(t2) + var(t0) / length(t0) - 2 * (cov(t0, t2) / length(t0))\nL95 <- delta_mean - tcrit2 * sqrt(V_delta_mean)\nU95 <- delta_mean + tcrit2 * sqrt(V_delta_mean)\n\nc(mean = delta_mean, L95 = L95, U95 = U95)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     mean       L95       U95 \n 8.600000  5.245209 11.954791 \n```\n\n\n:::\n:::\n\n\nTherefore the mean change is 8.6 and the 95% CI is [5.25,11.95].\n\n-- **End of Solution 6** --\n\n:::\n:::\n\n::: {.question}\n### Question 7\n\nWas there a significant change in the mean number of kangaroos between the study period, if we assume the same locations were resampled, or if different locations were sampled?\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::: {.ans}\n### Solution 7\n\nIf the 95% CI does not include 0 we can reject the null hypothesis and state that there is a significant change in the mean kangaroo numbers between the 2 survey times. This would be true for both scenarios.\n\n-- **End of Solution 7** --\n\n:::\n:::\n\n\n### Putting it together\n\nAs you should realise by now, the same data *may* produce different results depending on how it was analysed. This is the **danger** of statistics: **not clearly understanding the assumptions and implications of an experimental design can lead to incorrect analysis and conclusions.**\n\nAny statistical software, including R, will not tell you if you have made a mistake in your analysis. It is up to you to understand the implications of your design and to ensure that your work is appropriate. \n\nIn th case of this kangaroo study, the results are the same for both scenarios, which means that the implications lie in the context of future studies.\n\n::: {.question}\n### Question 8\n\nIn the future, would you re-sample the same sites, or visit new sites in a kangaroo monitoring program of the same woodland?\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::: {.ans}\n#### Solution 8\n\nIn this case, it would be better to visit new locations. Looking at the 95% CI, we can see that the precision of the estimate is higher when we sample at different locations between surveys since the bandwidth is smaller compared to when we sample at the same locations. This means that we can be more confident in the estimate of the change in mean when we sample at different locations.\n\n\nNote that the rationale here is that we are assuming that the same locations are representative of the woodland as a whole. If this is not the case, then we would need to consider a different approach.\n\n-- **End of Solution 8** --\n\n:::\n:::\n\n\n\n## Exercise 4 -- Equivalence to $t$-tests\n\nThe scenario when we *resample at different locations* between surveys is actually the equivalent to a **two-sample $t$-test**, and the scenario when we *resample the same locations* is equivalent to a **paired $t$-test**.\n\nWithout manually calculating and comparing the 95% CI, we can use the `t.test()` function in R to perform both of these tests.\n\nCheck your answers in R by trying to perform both of these using the `t.test()` function. Assume the variances are equal for the two-sample $t$-test (use the argument `var.equal = TRUE`for this).\n\n::: {.question}\n### Question 9\n\nCompare the 95% CI for each scenario between the `t.test()` results and the ones you calculated manually. Are they same?\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::: {.ans}\n### Solution 9\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Two-sample t-test\nfit1 <- t.test(t2, t0, var.equal = TRUE)\nfit1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tTwo Sample t-test\n\ndata:  t2 and t0\nt = 7.0692, df = 8, p-value = 0.0001052\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n  5.794625 11.405375\nsample estimates:\nmean of x mean of y \n     11.8       3.2 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Paired t-test\nfit2 <- t.test(t2, t0, paired = TRUE)\nfit2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPaired t-test\n\ndata:  t2 and t0\nt = 7.1174, df = 4, p-value = 0.00206\nalternative hypothesis: true mean difference is not equal to 0\n95 percent confidence interval:\n  5.245209 11.954791\nsample estimates:\nmean difference \n            8.6 \n```\n\n\n:::\n:::\n\n\nThe 95% CI for the two-sample $t$-test is 5.7946249, 11.4053751 and for the paired $t$-test is 5.2452086, 11.9547914.\n\nThe results are identical to the ones we calculated manually.\n\n-- **End of Solution 9** --\n\n:::\n:::\n\n## Thanks!\n\nDid you know you can also knit to PDF? Check the documentation for [R Markdown](https://bookdown.org/yihui/rmarkdown/pdf-document.html) or [Quarto](https://quarto.org/docs/output-formats/pdf-basics.html) for more information.\n\n### Attribution\n\nThis lab was developed using resources that are available under a [Creative Commons Attribution 4.0 International license], made available on the [SOLES Open Educational Resources repository].\n\n  [Creative Commons Attribution 4.0 International license]: http://creativecommons.org/licenses/by/4.0/\n  [SOLES Open Educational Resources repository]: https://github.com/usyd-soles-edu/",
    "supporting": [
      "Lab02-sample-designs_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}