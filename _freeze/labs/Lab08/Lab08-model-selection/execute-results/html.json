{
  "hash": "2b8a7212d9ad39151c89752eb47240ce",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"ENVX2001 - Model selection\"\n# revised-by: aca\neditor: visual\n---\n\n\n\n## Learning Outcomes\n\nIn this lab, you will work towards achieving learning outcomes\n\n## Lab Objectives\n\nIn this lab, we will:\n\n- []\n- []\n\n:::{.callout-tip}\nPlease work on this exercise by creating your own R Markdown file.\n:::\n\n\n## Exercise 1: Model quality - multiple vs adjusted *r*^2^ \n\nData:  *California_streamflow* spreadsheet  \n\nImport the \"California_streamflow\" sheet into R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load library if needed\nlibrary(readxl)\n# Load data\nstream_data <- read_xlsx(\"data/california_streamflow.xlsx\", \"streamflow\")\n```\n:::\n\n\nin this exercise we will use the same data as last week. To jog your memory, the dataset contains 43 years of annual precipitation measurements (in mm) taken at (originally) 6 sites in the Owens Valley in California. Through model selection via partial F-test we have the final model as below:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- lm(runoff_volume ~ rock_creek + pine_creek, data = stream_data)\n```\n:::\n\n\nWe will now add a totally useless variable to the dataset. This variable is a random number generated from a normal distribution with mean 3 and standard deviation 2. We use the `set.seed()` function to make sure that everybody gets the same random values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(100) # to make sure everybody gets the same results\n\n# this generates the random number into the dataset\nstream_data$random_no <- rnorm(n = nrow(stream_data), mean = 3, sd = 2) \n```\n:::\n\n  \nWe will see the impact of including a totally useless variable, such as this random variable, has on measures of model quality, *r*^2^ and adjusted *r*^2^ values.\n\n**Task: create two regression models:**\n\n1.  `runoff_volume ~ rock_creek + pine_creek` \n2.  `runoff_volume ~ rock_creek + pine_creek + random_no`  \n\n::: {.question}\n### Question 2\nCompare each in terms of their multiple *r*^2^ and adjusted *r*^2^ values. Which performance measure (multiple *r*^2^ or adj *r*^2^) would you use to identify which predictors to use in your model?\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n::: {.ans}\n### Answer\n\nThere is only a small difference in the multiple *r*^2^ and adj *r*^2^ between the models, but one goes up and the other goes down.\nSince the random number is a totally useless value, this demonstrates that the adjusted *r*^2^ is the better performance measure to use.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_rand1 <- lm(runoff_volume ~ rock_creek + pine_creek,data = stream_data)\nsummary(mod_rand1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = runoff_volume ~ rock_creek + pine_creek, data = stream_data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.09832 -0.02350  0.01076  0.03291  0.08568 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  3.35762    0.10547  31.835  < 2e-16 ***\nrock_creek   0.44437    0.08925   4.979 1.26e-05 ***\npine_creek   0.21051    0.06861   3.068  0.00385 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.04937 on 40 degrees of freedom\nMultiple R-squared:  0.8749,\tAdjusted R-squared:  0.8686 \nF-statistic: 139.8 on 2 and 40 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nmod_rand2 <- lm(runoff_volume ~ rock_creek + pine_creek + random_no ,data = stream_data)\nsummary(mod_rand2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = runoff_volume ~ rock_creek + pine_creek + random_no, \n    data = stream_data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.10327 -0.02401  0.01220  0.03179  0.08056 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 3.359356   0.106303  31.602  < 2e-16 ***\nrock_creek  0.442795   0.089956   4.922  1.6e-05 ***\npine_creek  0.207234   0.069324   2.989  0.00482 ** \nrandom_no   0.003213   0.005077   0.633  0.53055    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.04974 on 39 degrees of freedom\nMultiple R-squared:  0.8761,\tAdjusted R-squared:  0.8666 \nF-statistic: 91.96 on 3 and 39 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n:::\n:::\n## Exercise 2: Fish productivity\n\nFish communities were surveyed in lakes across a eutrophication gradient to investigate the relatioship between productivity and fish diversity.\n\nThe datasheet has thefollowing variables:\n\n- `lake_id` Unique identifier for each lake \n- `chla` Log-transformed Chlorophyll a\n- `richness` Log-transformed species richness\n- `evenness` Log-transformed Pielou’s evenness \t\n- `abundance` Log-transformed abundance per unit effort (NPUE) \t\n- `biomass` Log-transformed biomass per unit effort (BPUE) \n- `productivity` Log-transformed productivity proxy\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Load library if necessary\nlibrary(tidyverse)\n\n#Read in data\nfish_data <- read_csv(\"data/fish_communities.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 39 Columns: 7\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): lake_id\ndbl (6): chla, richness, evenness, abundance, biomass, productivity\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n#Have a look at the structure of the data\nstr(fish_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nspc_tbl_ [39 × 7] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ lake_id     : chr [1:39] \"FTH\" \"XLH\" \"HGH\" \"LH\" ...\n $ chla        : num [1:39] 4.61 4.53 3.84 3.71 2.43 ...\n $ richness    : num [1:39] 2.64 2.89 1.99 2.94 2.37 ...\n $ evenness    : num [1:39] -0.356 -0.67 -0.423 -0.405 -0.589 ...\n $ abundance   : num [1:39] 2.24 3.34 1.24 2.67 1.12 ...\n $ biomass     : num [1:39] 4.96 6.03 4.67 6.52 5.32 ...\n $ productivity: num [1:39] 3.47 4.47 2.71 4.47 3.24 ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   lake_id = col_character(),\n  ..   chla = col_double(),\n  ..   richness = col_double(),\n  ..   evenness = col_double(),\n  ..   abundance = col_double(),\n  ..   biomass = col_double(),\n  ..   productivity = col_double()\n  .. )\n - attr(*, \"problems\")=<externalptr> \n```\n\n\n:::\n:::\n\n\nExplore the data on your own before making any models. \n(*Hint:* remember that we are only interested in the numeric variables for our linear models)\n\n::: {.question}\n### Question 1\n\nAre there any obvious relationships between the response variable (productivity) and the other variables?\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n::: {.ans}\n### Answer\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#correlation matrix\ncor(fish_data[,-1])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  chla   richness   evenness  abundance    biomass productivity\nchla         1.0000000  0.2388845  0.0872381  0.3449158  0.2809369    0.3406440\nrichness     0.2388845  1.0000000 -0.3295238  0.6585895  0.5704803    0.6611413\nevenness     0.0872381 -0.3295238  1.0000000 -0.5553243 -0.4396433   -0.5162017\nabundance    0.3449158  0.6585895 -0.5553243  1.0000000  0.8089680    0.9379798\nbiomass      0.2809369  0.5704803 -0.4396433  0.8089680  1.0000000    0.9571907\nproductivity 0.3406440  0.6611413 -0.5162017  0.9379798  0.9571907    1.0000000\n```\n\n\n:::\n\n```{.r .cell-code}\n#Plot the variables\n\npairs(fish_data[,-1])\n```\n\n::: {.cell-output-display}\n![](Lab08-model-selection_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\nProductivity has a strong relationship with biomass and abundance\n:::\n:::\n\n::: {.question}\n### Question 2\n\nAre there any other patterns or potential issues you can see from the exploratory plots?\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n::: {.ans}\n### Answer\n\nBiomass is also highly correlated with abundance, so collinearity might be an issue.\n:::\n:::\n\n\n## Take home exercise:\n\n## Review\n\n### Attribution\n",
    "supporting": [
      "Lab08-model-selection_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}