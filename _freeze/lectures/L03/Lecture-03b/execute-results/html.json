{
  "hash": "14b354c89841243b475372279ed94204",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Lecture 03b -- One-way ANOVA\nauthor: Januar Harianto\nformat: ochre-revealjs\nexecute:\n  echo: true\n  warning: false\n  message: false\ntoc: true\ntoc-depth: 1\ntoc-title: Outline\n---\n\n\n\n\n# Why ANOVA?\n\n## The problem with multiple $t$-tests\n\nSuppose we want to compare weight gain of chicks fed on **4 different diets**.\n\n::: fragment\nWith $t$-tests, we'd need $\\binom{4}{2} = 6$ pairwise comparisons:\n\n1-2, 1-3, 1-4, 2-3, 2-4, 3-4\n:::\n\n::: fragment\nEven if there are no true differences, each test has a 5% chance of incorrectly finding significance. How does that add up?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprob_all_correct <- 0.95^6\nprob_all_correct\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.7350919\n```\n\n\n:::\n:::\n\n\nWe have a **26.5%** chance that at least one test result will be incorrect!\n:::\n\n\n## We need a better method\n\nThe [problem of multiple comparisons](https://en.wikipedia.org/wiki/Multiple_comparisons_problem) requires a technique that considers **all** treatments at once.\n\n::: fragment\n### ANOVA -- Analysis of Variance\n\nBefore deciding *which* treatments differ, we first consider:\n\n::: incremental\n1. Differences **between** the treatment groups -- **between-treatment effects**\n2. Differences **within** each treatment group -- **within-treatment effects**\n   - due to random environmental fluctuations, genetics, experimental error\n:::\n:::\n\n\n# Chick weight data\n\n## The experiment\n\n:::: columns\n::: {.column width=\"40%\"}\n![](images/chicks.jpg)\n\n- 20 chicks\n- 4 diets\n- 5 replicates per diet\n- Response: weight gain (g)\n:::\n\n::: {.column width=\"60%\"}\n::: fragment\n\n::: {.cell}\n\n```{.r .cell-code}\nchicks_wide <- read.csv(\"data/chicks.csv\")\nchicks_wide\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Diet.1 Diet.2 Diet.3 Diet.4\n1     99     61     42    169\n2     88    112     97    137\n3     76     30     81    169\n4     38     89     95     85\n5     94     63     92    154\n```\n\n\n:::\n:::\n\n:::\n:::\n::::\n\n\n## Reshaping the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchicks <- read.csv(\"data/chicks.csv\") |>\n  pivot_longer(\n    cols = starts_with(\"Diet\"),\n    names_to = \"diet\",\n    values_to = \"weight\"\n  ) |>\n  mutate(diet = as.factor(diet))\n\nchicks\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 20 Ã— 2\n   diet   weight\n   <fct>   <int>\n 1 Diet.1     99\n 2 Diet.2     61\n 3 Diet.3     42\n 4 Diet.4    169\n 5 Diet.1     88\n 6 Diet.2    112\n 7 Diet.3     97\n 8 Diet.4    137\n 9 Diet.1     76\n10 Diet.2     30\n11 Diet.3     81\n12 Diet.4    169\n13 Diet.1     38\n14 Diet.2     89\n15 Diet.3     95\n16 Diet.4     85\n17 Diet.1     94\n18 Diet.2     63\n19 Diet.3     92\n20 Diet.4    154\n```\n\n\n:::\n:::\n\n\n\n# ANOVA concepts\n\n## Terminology\n\n- **Factor** (or treatment): the categorical variable of interest (here: diet)\n- **Levels**: the categories within a factor (here: Diet 1, Diet 2, Diet 3, Diet 4)\n- **Replicates**: the number of observations per level (here: $r = 5$)\n- $t$ = number of treatments; $N$ = total observations = $r \\times t = 20$\n\n::: fragment\nThis is a **one-way** (or one-factor) ANOVA because there is only one factor (diet).\n:::\n\n\n## Which model best describes the data?\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\noverall_mean <- mean(chicks$weight)\ngroup_means <- chicks |>\n  group_by(diet) |>\n  summarise(mean_wt = mean(weight))\n\np1 <- ggplot(chicks, aes(diet, weight)) +\n  geom_point(size = 3, alpha = 0.6) +\n  geom_point(data = group_means, aes(diet, mean_wt),\n    shape = 18, size = 5, colour = \"red\") +\n  labs(title = \"Group means (red)\", x = \"Diet\", y = \"Weight (g)\")\n\np2 <- ggplot(chicks, aes(diet, weight)) +\n  geom_point(size = 3, alpha = 0.6) +\n  geom_hline(yintercept = overall_mean, colour = \"blue\",\n    linewidth = 1, linetype = \"dashed\") +\n  labs(title = \"Overall mean (blue)\", x = \"Diet\", y = \"Weight (g)\")\n\nlibrary(patchwork)\np1 + p2\n```\n\n::: {.cell-output-display}\n![](Lecture-03b_files/figure-html/group_means_plot-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nDoes the **group means model** (left) explain the data better than the **overall mean model** (right)?\n\n\n# Model equation\n\n## Same form as the $t$-test\n\n$$y_{ij} = \\mu_i + \\varepsilon_{ij}$$\n\n- $i = 1, 2, \\ldots, t$ (treatment); $j = 1, 2, \\ldots, n_i$ (replicate)\n\nIn the chick example:\n\n- $y_{ij}$ = observed weight gain for the $j$th chick on Diet $i$\n- $\\mu_i$ = mean weight gain for chicks on Diet $i$\n- $\\varepsilon_{ij}$ = random error (residual)\n\n\n# Assumptions\n\n## Checking normality\n\n:::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(chicks, aes(diet, weight)) +\n  geom_boxplot() +\n  labs(x = \"Diet\", y = \"Weight (g)\")\n```\n\n::: {.cell-output-display}\n![](Lecture-03b_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=672}\n:::\n:::\n\n:::\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(chicks$weight)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  chicks$weight\nW = 0.93272, p-value = 0.1742\n```\n\n\n:::\n:::\n\n\n$p > 0.05$: we can assume normality.\n:::\n::::\n\n\n## Checking equal variances\n\n- $\\sigma_1^2 = \\sigma_2^2 = \\ldots = \\sigma_t^2$\n- General guide: $\\frac{\\text{largest SD}}{\\text{smallest SD}} < 2.0$\n- Alternatively, use **Bartlett's test** of homogeneity of variance:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbartlett.test(weight ~ diet, data = chicks)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBartlett test of homogeneity of variances\n\ndata:  weight by diet\nBartlett's K-squared = 0.85164, df = 3, p-value = 0.8371\n```\n\n\n:::\n:::\n\n\n::: {.callout-warning}\nBartlett's test is **sensitive to non-normality**. Only use it when normality is reasonable.\n:::\n\n\n# Hypothesis test\n\n## Hypotheses\n\n- **Null hypothesis**: $H_0: \\mu_1 = \\mu_2 = \\ldots = \\mu_t$\n- **Alternative hypothesis**: $H_1$: not all $\\mu_i$ are equal\n\n::: {.callout-important}\nANOVA only tells us that **at least two** group means are different -- not *which* ones.\n:::\n\n\n## The concept: partition variability\n\nPartition the total variability into components:\n\n$$SS_{\\text{total}} = SS_{\\text{treatment}} + SS_{\\text{residual}}$$\n\n- $SS_{\\text{treatment}}$: variation **between** groups (due to diet)\n- $SS_{\\text{residual}}$: variation **within** groups (random error)\n\n::: fragment\nIf the treatment has a real effect, $SS_{\\text{treatment}}$ should be **large** relative to $SS_{\\text{residual}}$.\n:::\n\n\n# Variance partitioning\n\n## Total sum of squares: $SS_{\\text{total}}$\n\n$$SS_{\\text{total}} = \\sum(y_{ij} - \\bar{y})^2$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\noverall_mean <- mean(chicks$weight)\nss_total <- sum((chicks$weight - overall_mean)^2)\nss_total\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 29678.95\n```\n\n\n:::\n:::\n\n\n\n## Treatment sum of squares: $SS_{\\text{treatment}}$\n\n$$SS_{\\text{treatment}} = \\sum n_i \\times (\\bar{y}_i - \\bar{y})^2$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngroup_means <- chicks |>\n  group_by(diet) |>\n  summarise(grp_mean = mean(weight))\n\nss_trt <- sum(5 * (group_means$grp_mean - overall_mean)^2)\nss_trt\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 16466.95\n```\n\n\n:::\n:::\n\n\n\n## Residual sum of squares: $SS_{\\text{residual}}$\n\n$$SS_{\\text{residual}} = \\sum(y_{ij} - \\bar{y}_i)^2$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchicks_with_means <- chicks |>\n  left_join(group_means, by = \"diet\")\n\nss_res <- sum((chicks_with_means$weight - chicks_with_means$grp_mean)^2)\nss_res\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 13212\n```\n\n\n:::\n:::\n\n\n::: fragment\n**Check**: $SS_{\\text{total}} = SS_{\\text{treatment}} + SS_{\\text{residual}}$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc(ss_total, ss_trt + ss_res)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 29678.95 29678.95\n```\n\n\n:::\n:::\n\n:::\n\n\n# ANOVA table\n\n## Structure\n\n| Source | df | SS | MS | F |\n|--------|----|----|----|----|\n| Treatment | $t - 1$ | $SS_{\\text{trt}}$ | $SS_{\\text{trt}} / (t-1)$ | $MS_{\\text{trt}} / MS_{\\text{res}}$ |\n| Residual | $N - t$ | $SS_{\\text{res}}$ | $SS_{\\text{res}} / (N-t)$ | |\n| **Total** | $N - 1$ | $SS_{\\text{total}}$ | | |\n\n- $N$ = total observations, $t$ = number of treatment levels\n- **Mean Squares** (MS) standardise SS so they are comparable\n- The larger the ratio $MS_{\\text{trt}} / MS_{\\text{res}}$, the stronger the treatment effect\n\n## Using `aov()` in R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel <- aov(weight ~ diet, data = chicks)\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Df Sum Sq Mean Sq F value Pr(>F)   \ndiet         3  16467    5489   6.647  0.004 **\nResiduals   16  13212     826                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n## Interpreting the results\n\n\n::: {.cell}\n\n:::\n\n\n- $F = 6.65$ with $df = 3, 16$\n- $p = 0.004$ which is $< 0.05$, so we **reject** $H_0$\n- There are **significant differences** in mean weight gain amongst the 4 diets\n\n::: fragment\n### How much variability is explained?\n\n$$\\frac{SS_{\\text{treatment}}}{SS_{\\text{total}}} = \\frac{1.6467\\times 10^{4}}{2.9679\\times 10^{4}} = 55.5\\%$$\n\nThe diets explain about 55% of the total variability in chick weight gain.\n:::\n\n\n# Post-hoc: which groups differ?\n\n## Confidence intervals for group means\n\nWe can examine 95% CIs for each treatment mean:\n\n$$95\\% \\text{ CI} = \\bar{y}_i \\pm t^{0.025}_{N-t} \\times SE(\\bar{y}_i)$$\n\nwhere $SE(\\bar{y}_i) = \\sqrt{MS_{\\text{res}} / n_i}$\n\n\n## Using `emmeans`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(emmeans)\nemm <- emmeans(model, \"diet\")\nemm\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n diet   emmean   SE df lower.CL upper.CL\n Diet.1   79.0 12.9 16     51.8    106.2\n Diet.2   71.0 12.9 16     43.8     98.2\n Diet.3   81.4 12.9 16     54.2    108.6\n Diet.4  142.8 12.9 16    115.6    170.0\n\nConfidence level used: 0.95 \n```\n\n\n:::\n:::\n\n\n\n## Visualising group comparisons\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(emm, comparisons = TRUE) +\n  labs(x = \"Weight (g)\", y = \"Diet\")\n```\n\n::: {.cell-output-display}\n![](Lecture-03b_files/figure-html/plot_ci-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nGroups with **overlapping** arrows are **not** significantly different from each other.\n\n\n# Summary\n\n## $t$-test vs ANOVA\n\n::: incremental\n- **$t$-test**: compares means of **2** groups\n- **ANOVA**: compares means of **2 or more** groups simultaneously\n- ANOVA avoids the inflated Type I error rate from multiple $t$-tests\n- The ANOVA $F$-test tells us *if* differences exist, but not *where*\n- Post-hoc methods (e.g. `emmeans`) identify *which* pairs differ\n:::\n\n\n## Next week\n\n- How to better identify which pairs are significantly different\n- How to test and interpret model assumptions using **residual diagnostics**\n\n\n## References\n\n- Quinn & Keough (2002), Chapter 7: Section 7.1\n- Mead et al. (2002), Chapter 18: Sections 18.1--18.3\n\n\n## Thanks! {.center-h}\n\n### Questions?\n\nThis presentation is based on the [SOLES Quarto reveal.js template][soles-revealjs] and is licensed under a [Creative Commons Attribution 4.0 International License][cc-by].\n\n\n[soles-revealjs]: https://github.com/usyd-soles-edu/soles-revealjs\n[cc-by]: http://creativecommons.org/licenses/by/4.0/\n",
    "supporting": [
      "Lecture-03b_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}