{
  "hash": "3a4cb07f91bd9365c974af3c74a2a3ea",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tutorial 05: Experimental Design and ANOVA\"\n# reviewed-by:\n---\n\n\n\nIn this week's lectures we covered complete randomised designs (CRD) and randomized block designs (RBD) for experiments with one factor or treatment. We also covered analysis of variance (ANOVA) as a method to analyse data from these experimental designs.\n\n::: callout-tip\n## Key learning outcomes\n\n-   Assess the validity of an experiment in terms of the appropriateness of replication:\n    -   Randomisation\n    -   Experimental unit vs sampling unit\n    -   Replication\n-   Control of variation\n    -   Completely randomised design (CRD)\n    -   Explain the concept of blocking\n    -   Randomised complete block design (RCBD)\n    -   Know how to calculate the % variation explained by treatments and blocking terms\n:::\n\n# Randomisation\n\nRandomisation is a key principle of experimental design. It helps to ensure that the treatment groups are comparable and that the results of the experiment are not biased by confounding factors.\n\n::: callout-important\n## Why randomise?\n\n-   It helps to eliminate bias in the allocation of treatments to experimental units.\n-   It helps to ensure that the treatment groups are comparable.\n-   It helps to ensure that the results of the experiment are not confounded by other factors.\n-   It is a key assumption of all statistical models.\n:::\n\n## Exercise 1: Testing randomisation\n\nLet's work together as a class to test the effect of randomisation on an experiment. We will simulate an experiment with and without randomisation and compare the results.\n\nAssign each student a number from 1 to the total number of students in the class. Each student will be asked to answer the question:\n\n> \"Do you know the student next to you? Yes or No\"\n\n### 1.1) Non-random sample\n\n> \"Do you know the student sitting next to you? Yes or No\"\n\nPut your hand up if you answer \"Yes\", and keep it down if you answer \"No\". The students with their hands up are counted as \"Yes\" and the students with their hands down are counted as \"No\". This is our non-random sample.\n\n**Class answers** — Replace these with your class numbers:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntotal_nonrandom <- 60 # total students in non-random sample/class size\ncount_yes_nonrandom <- 38 # yes I know the person next to me\ncount_no_nonrandom  <- 22 # no I don't know the person next to me\n```\n:::\n\n\n**Class size (number of students present):**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass_size <- total_nonrandom\n```\n:::\n\n\n\n### 1.2) Percentages from the non-random sample\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprop_yes_nonrandom <- (count_yes_nonrandom / total_nonrandom) * 100\nprop_no_nonrandom  <- (count_no_nonrandom  / total_nonrandom) * 100\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(\"Non-random sample % Yes:\", round(prop_yes_nonrandom, 1), \"%\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNon-random sample % Yes: 63.3 %\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Non-random sample % No :\", round(prop_no_nonrandom, 1),  \"%\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNon-random sample % No : 36.7 %\n```\n\n\n:::\n:::\n\n\n### 1.3) Random sample\n\nWe simulate student IDs and assign a random number to each ID.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)  # For reproducibility\nstudent_ids <- seq_len(class_size)\nrand_num <- runif(class_size)\nclass_df <- data.frame(id = student_ids, rand_num = rand_num)\n```\n:::\n\n\n**Random sample size (how many students you will sample at random):**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrandom_sample_size <- 30 # choose a sample size for the random sample\n```\n:::\n\n\n**Randomly select students:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(202)\nsampled_ids <- sample(class_df$id, size = random_sample_size, replace = FALSE)\n\nsampled_ids # students with these numbers were randomly selected to be asked the question again.\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 16 46 40  8  6 60 22 36 45 57 33 51 55 11 27 43 41 25 49 54 47 24 29 39 59\n[26] 17 13  1 50  4\n```\n\n\n:::\n:::\n\n\n> \"Do you know the student next to you? Yes or No\"\n\n**Enter counts for the random sample:**\n\nAfter you randomly select those students and ask the question, enter the counts here.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncount_yes_random <- 14\ncount_no_random  <- 16\n```\n:::\n\n\n**Percentages for the random sample:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprop_yes_random <- (count_yes_random / random_sample_size) * 100\nprop_no_random  <- (count_no_random  / random_sample_size) * 100\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(\"Random sample % Yes:\", round(prop_yes_random, 1), \"%\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRandom sample % Yes: 46.7 %\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Random sample % No :\", round(prop_no_random, 1),  \"%\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRandom sample % No : 53.3 %\n```\n\n\n:::\n:::\n\n\n**Estimate the bias:**\n\nBias here is the difference between the non-random sample proportion and the random sample proportion.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbias_yes <- prop_yes_nonrandom - prop_yes_random\nbias_no  <- prop_no_nonrandom  - prop_no_random\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(\"Estimated bias in % Yes (non-random - random):\", round(bias_yes, 1), \"%\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimated bias in % Yes (non-random - random): 16.7 %\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Estimated bias in % No  (non-random - random):\", round(bias_no, 1),  \"%\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimated bias in % No  (non-random - random): -16.7 %\n```\n\n\n:::\n:::\n\n\n**Visualisation:**\n\nBar plot of % Yes/No for non-random vs random samples using ggplot2.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npercent_df <- data.frame(\n  sample_type = rep(c(\"Non-random sample\", \"Random sample\"), each = 2),\n  response     = rep(c(\"Yes\", \"No\"), times = 2),\n  percent      = c(prop_yes_nonrandom, prop_no_nonrandom, prop_yes_random, prop_no_random)\n)\n\nlibrary(ggplot2)\n\np <- ggplot(percent_df, aes(x = response, y = percent, fill = sample_type)) +\n  geom_col(position = position_dodge(width = 1)) +\n  labs(title = \"Non-random vs Random Sample: % Knowing the Neighbour\",\n       x = \"Response\", y = \"Percent\", fill = \"Sample type\") +\n  scale_fill_manual(values = c(\"Non-random sample\" = \"#4C78A8\", \"Random sample\" = \"#F58518\")) +\n  theme_minimal(base_size = 12)\n\nprint(p)\n```\n\n::: {.cell-output-display}\n![](tutorial05_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nNon-random sampling (asking about the person next to you) is typically biased because seating patterns cluster friends or cohorts.\n\n-   Random sampling gives each student an equal chance, reducing systematic bias.\n-   Comparing the two percentages provides a simple measure of bias in this context.\n\n---\n\n# Experimental Unit vs Sampling Unit\n\nIn an experiment, it is important to distinguish between the experimental unit and the sampling unit.\n\n::: callout-important\n## Experimental unit vs Sampling unit\n\n-   The **experimental unit** is the smallest unit to which a treatment is applied.\n-   The **sampling unit** is the smallest unit from which measurements are taken.\n:::\n\n## Exercise 2: Identifying units\n\nConsider an experiment to test the effect of different fertilizers on plant growth. The experiment uses 12 pots, with 4 pots assigned to each of 3 fertilizer treatments (A, B, and C). Each pot contains 5 plants, and the height of each plant is measured after 4 weeks.\n\n> What is the experimental unit and what is the sampling unit in this experiment?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Experimental unit: pot\n# Sampling unit: individual plant\n```\n:::\n\n\n-   The experimental unit is the pot, as the fertilizer treatment is applied to the entire pot.\n-   The sampling unit is the individual plant, as the height of each plant is measured.\n\n> Working in pairs, identify other examples of experimental units vs sampling units and check answers with staff.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Examples here\n```\n:::\n\n\n---\n\n# Replication\n\nReplication is the repetition of an experimental condition to estimate the variability of the data and increase the precision of the results.\n\n::: callout-important\n## Why replicate?\n\n-   To estimate the variability of the data.\n-   To increase the precision of the results.\n-   To increase the power of statistical tests.\n:::\n\nConsider the plant growth experiment above. If each fertilizer treatment is applied to only one pot, there is no replication, and it is impossible to estimate the variability of plant growth within each treatment. However, if each fertilizer treatment is applied to 4 pots, there is replication, allowing for estimation of variability and more reliable statistical analysis.\n\n::: callout-tip\n## Understanding variation is our job as scientists!\n\n-   Variation is inherent in all biological systems.\n-   Our job is to understand and account for this variation in our experimental designs and analyses.\n:::\n\n---\n\n# Control of Variation: Completely Randomised Design (CRD)\n\nIn a Completely Randomised Design (CRD), experimental units are randomly assigned to treatments. This design is appropriate when the experimental units are homogeneous and there are no known sources of variation that need to be controlled.\n\n![Completely Randomised Design](images/Slide1.PNG){fig-align=\"center\" width=\"767\"}\n\n::: callout-tip\n## Key features of CRD\n\n-   Random assignment of treatments to experimental units.\n-   Appropriate for homogeneous experimental units.\n-   Simple to implement and analyse.\n:::\n\nSimple experiments can be easier to interpret, but may not control for variation as well as more complex designs.\n\n## Exercise 3: Completely Randomised Design (CRD)\n\nConsider an experiment to test the effect of different fertilizers on plant growth using a CRD. The experiment uses 12 pots, with 4 pots assigned to each of 3 fertilizer treatments (A, B, and C). Each pot contains 5 plants, and the height of each plant is measured after 4 weeks.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Randomly assign treatments to pots\nset.seed(123)\ntreatments <- rep(c(\"A\", \"B\", \"C\"), each = 4)\npots <- data.frame(\n  pot_id = 1:12,\n  treatment = sample(treatments)\n)\npots\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   pot_id treatment\n1       1         A\n2       2         C\n3       3         C\n4       4         A\n5       5         B\n6       6         C\n7       7         B\n8       8         A\n9       9         C\n10     10         B\n11     11         A\n12     12         B\n```\n\n\n:::\n:::\n\n\n-   The treatments are randomly assigned to the pots.\n-   The height of each plant is measured after 4 weeks.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simulate plant height data\nset.seed(456)\nplant_heights <- data.frame(\n  pot_id = rep(1:12, each = 5),\n  plant_id = 1:60,\n  height = rnorm(60, mean = rep(c(10, 15, 20), each = 20), sd = 2)\n)\nplant_heights <- merge(plant_heights, pots, by = \"pot_id\")\nplant_heights\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   pot_id plant_id    height treatment\n1       1        1  7.312957         A\n2       1        2 11.243551         A\n3       1        3 11.601749         A\n4       1        4  7.222215         A\n5       1        5  8.571286         A\n6       2        6  9.351878         C\n7       2        7 11.381286         C\n8       2        8 10.501096         C\n9       2        9 12.014705         C\n10      2       10 11.146469         C\n11      3       11  8.168379         C\n12      3       12 12.622195         C\n13      3       13 11.977453         C\n14      3       14 13.307857         C\n15      3       15  7.118390         C\n16      4       16 13.894713         A\n17      4       17 13.473872         A\n18      4       18 10.774967         A\n19      4       19 14.560068         A\n20      4       20 13.075767         A\n21      5       21 14.050792         B\n22      5       22 11.565382         B\n23      5       23 12.146339         B\n24      5       24 15.416472         B\n25      5       25 14.928328         B\n26      6       26 17.268569         C\n27      6       27 14.074290         C\n28      6       28 14.343232         C\n29      6       29 17.969079         C\n30      6       30 12.821244         C\n31      7       31 13.942412         B\n32      7       32 13.812414         B\n33      7       33 11.002169         B\n34      7       34 15.592306         B\n35      7       35 15.341251         B\n36      8       36 18.631305         A\n37      8       37 13.678794         A\n38      8       38 14.719496         A\n39      8       39 14.152042         A\n40      8       40 14.922528         A\n41      9       41 19.942116         C\n42      9       42 20.786075         C\n43      9       43 19.500772         C\n44      9       44 20.166900         C\n45      9       45 24.157749         C\n46     10       46 20.241704         B\n47     10       47 20.236299         B\n48     10       48 21.540108         B\n49     10       49 17.649195         B\n50     10       50 20.818077         B\n51     11       51 18.670098         A\n52     11       52 19.486950         A\n53     11       53 21.357564         A\n54     11       54 21.793689         A\n55     11       55 21.236713         A\n56     12       56 21.462907         B\n57     12       57 19.173651         B\n58     12       58 23.115626         B\n59     12       59 21.083398         B\n60     12       60 21.154301         B\n```\n\n\n:::\n:::\n\n\n-   The data can be analysed using ANOVA to test for differences in plant height between the fertilizer treatments.\n\n> Is there a significant difference in plant height between the fertilizer treatments?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# answer here\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ANOVA analysis\nanova_result <- aov(height ~ treatment, data = plant_heights)\nsummary(anova_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Df Sum Sq Mean Sq F value Pr(>F)  \ntreatment    2  100.1   50.04   2.641   0.08 .\nResiduals   57 1080.2   18.95                 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n-   The ANOVA results will indicate whether there are significant differences in plant height between the fertilizer treatments.\n\n---\n\n# Control of Variation: Randomised Complete Block Design (RCBD)\n\nIn a Randomised Complete Block Design (RCBD), experimental units are grouped into blocks based on known sources of variation, and treatments are randomly assigned within each block. This design is appropriate when there are known sources of variation that need to be controlled.\n\n![Randomised Complete Block Design](images/Slide2.PNG)\n\n::: callout-tip\n## Key features of RCBD\n\n-   Grouping of experimental units into blocks.\n-   Random assignment of treatments within blocks.\n-   Appropriate for heterogeneous experimental units.\n:::\n\n## Exercise 4: Randomised Complete Block Design (RCBD)\n\nConsider an experiment to test the effect of different fertilizers on plant growth using an RCBD. The experiment uses 12 pots, with 4 pots assigned to each of 3 fertilizer treatments (A, B, and C). The pots are grouped into 4 blocks based on their location in the greenhouse (North, South, East, West). Each pot contains 5 plants, and the height of each plant is measured after 4 weeks.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create blocks and randomly assign treatments within blocks\nset.seed(123)\nblocks <- rep(c(\"North\", \"South\", \"East\", \"West\"), each = 3)\ntreatments <- rep(c(\"A\", \"B\", \"C\"), times = 4)\npots <- data.frame(\n  pot_id = 1:12,\n  block = blocks,\n  treatment = sample(treatments)\n)\npots\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   pot_id block treatment\n1       1 North         C\n2       2 North         C\n3       3 North         A\n4       4 South         B\n5       5 South         C\n6       6 South         B\n7       7  East         B\n8       8  East         A\n9       9  East         C\n10     10  West         B\n11     11  West         A\n12     12  West         A\n```\n\n\n:::\n:::\n\n\n-   The treatments are randomly assigned to the pots within each block.\n-   The height of each plant is measured after 4 weeks.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simulate plant height data\nset.seed(456)\nplant_heights <- data.frame(\n  pot_id = rep(1:12, each = 5),\n  plant_id = 1:60,\n  height = rnorm(60, mean = rep(c(10, 15, 20), each = 20) + rep(c(2, -2, 1, -1), each = 15), sd = 2)\n)\nplant_heights <- merge(plant_heights, pots, by = \"pot_id\")\nplant_heights\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   pot_id plant_id    height block treatment\n1       1        1  9.312957 North         C\n2       1        2 13.243551 North         C\n3       1        3 13.601749 North         C\n4       1        4  9.222215 North         C\n5       1        5 10.571286 North         C\n6       2        6 11.351878 North         C\n7       2        7 13.381286 North         C\n8       2        8 12.501096 North         C\n9       2        9 14.014705 North         C\n10      2       10 13.146469 North         C\n11      3       11 10.168379 North         A\n12      3       12 14.622195 North         A\n13      3       13 13.977453 North         A\n14      3       14 15.307857 North         A\n15      3       15  9.118390 North         A\n16      4       16 11.894713 South         B\n17      4       17 11.473872 South         B\n18      4       18  8.774967 South         B\n19      4       19 12.560068 South         B\n20      4       20 11.075767 South         B\n21      5       21 12.050792 South         C\n22      5       22  9.565382 South         C\n23      5       23 10.146339 South         C\n24      5       24 13.416472 South         C\n25      5       25 12.928328 South         C\n26      6       26 15.268569 South         B\n27      6       27 12.074290 South         B\n28      6       28 12.343232 South         B\n29      6       29 15.969079 South         B\n30      6       30 10.821244 South         B\n31      7       31 14.942412  East         B\n32      7       32 14.812414  East         B\n33      7       33 12.002169  East         B\n34      7       34 16.592306  East         B\n35      7       35 16.341251  East         B\n36      8       36 19.631305  East         A\n37      8       37 14.678794  East         A\n38      8       38 15.719496  East         A\n39      8       39 15.152042  East         A\n40      8       40 15.922528  East         A\n41      9       41 20.942116  East         C\n42      9       42 21.786075  East         C\n43      9       43 20.500772  East         C\n44      9       44 21.166900  East         C\n45      9       45 25.157749  East         C\n46     10       46 19.241704  West         B\n47     10       47 19.236299  West         B\n48     10       48 20.540108  West         B\n49     10       49 16.649195  West         B\n50     10       50 19.818077  West         B\n51     11       51 17.670098  West         A\n52     11       52 18.486950  West         A\n53     11       53 20.357564  West         A\n54     11       54 20.793689  West         A\n55     11       55 20.236713  West         A\n56     12       56 20.462907  West         A\n57     12       57 18.173651  West         A\n58     12       58 22.115626  West         A\n59     12       59 20.083398  West         A\n60     12       60 20.154301  West         A\n```\n\n\n:::\n:::\n\n\nThe data can be analysed using ANOVA to test for differences in plant height between the fertilizer treatments while accounting for block effects.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ANOVA analysis with blocking\nanova_result <- aov(height ~ block + treatment, data = plant_heights)\nsummary(anova_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Df Sum Sq Mean Sq F value   Pr(>F)    \nblock        3  664.5  221.50  41.589 4.59e-14 ***\ntreatment    2   33.5   16.77   3.148   0.0509 .  \nResiduals   54  287.6    5.33                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nThe ANOVA results will indicate whether there are significant differences in plant height between the fertilizer treatments while controlling for block effects.\n\nThe percentage of variation explained by treatments and blocking terms can be calculated from the ANOVA table.\n\n::: callout-tip\n## Calculating percentage of variation explained\n\n-   Sum of Squares (SS) for each source of variation can be found in the ANOVA table.\n-   Percentage of variation explained by a source = (SS for that source / Total SS) × 100\n\nFor example, to calculate the percentage of variation explained by treatments and blocks:\n\n-   SS_total = Sum of Squares Total\n-   SS_treatment = Sum of Squares for Treatment\n-   SS_block = Sum of Squares for Block\n\nPercentage of variation explained by treatments = (SS_treatment / SS_total) × 100\n\nPercentage of variation explained by blocks = (SS_block / SS_total) × 100\n:::\n\nWe are using R to subset the ANOVA results to calculate these percentages, but you can do this by hand from the ANOVA table using a calculator. Try this and compare your answers to the results from the code below.\n\n::: callout-important\n## Note\n\nYou will need to know how to read the ANOVA table and calculate the percentage variation explained by hand for your assessments.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova_table <- summary(anova_result)[[1]]\nss_total <- sum(anova_table$`Sum Sq`)\nss_treatment <- anova_table$`Sum Sq`[2]\nss_block <- anova_table$`Sum Sq`[1]\npercent_treatment <- (ss_treatment / ss_total) * 100\npercent_block <- (ss_block / ss_total) * 100\ncat(\"Percentage of variation explained by treatments:\", round(percent_treatment, 1), \"%\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPercentage of variation explained by treatments: 3.4 %\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Percentage of variation explained by blocks:\", round(percent_block, 1), \"%\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPercentage of variation explained by blocks: 67.4 %\n```\n\n\n:::\n:::\n\n\nThis information helps to understand the contribution of treatments and blocks to the overall variation in plant height.\n\n---\n\n# Summary\n\nIn this tutorial, we covered key concepts in experimental design, including randomisation, experimental units vs sampling units, replication, and control of variation through CRD and RCBD. We also demonstrated how to analyse data from these designs using ANOVA in R.\n\n## Example exam questions\n\n1.  Define the terms \"experimental unit\" and \"sampling unit\". Provide an example of each from a hypothetical agricultural experiment.\n\n2.  Explain the importance of randomisation in experimental design. How does randomisation help to reduce bias in an experiment?\n\n3.  Describe the key features of a Completely Randomised Design (CRD). When is it appropriate to use a CRD?\n\n4.  Describe the key features of a Randomised Complete Block Design (RCBD). When is it appropriate to use an RCBD?\n\n5.  Given an ANOVA table from an RCBD experiment, calculate the percentage of variation explained by treatments and blocks.\n",
    "supporting": [
      "tutorial05_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}