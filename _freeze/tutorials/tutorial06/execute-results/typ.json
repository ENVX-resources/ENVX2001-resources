{
  "hash": "eb755e275c7af412def0f4643a7ae49e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tutorial 06: Factorial Designs\"\n# reviewed-by:\n---\n\n\n\nIn this week's lectures we covered factorial designs, main effects and interactions. We applied these concepts by using analysis of variance (ANOVA) as a method to analyse data from these experimental designs.\n\n::: callout-tip\n## Key learning outcomes\n\n-   Treatment Designs and Experimental Designs\n-   Factorial Treatment Structures\n    -   Main Effects and Interactions, including graphical interpretations\n    -   ANOVA with Factorial Treatment Designs (up to 3-way designs, with and without blocking)\n:::\n\n# Treatment Designs and Experimental Designs\n\nAn experimental design is a structured approach to conducting experiments that allows researchers to systematically investigate the effects of one or more factors on a response variable. Treatment designs refer to the specific arrangements of treatments (or interventions) applied to experimental units within an experimental design. There are several types of treatment designs, including (but not limited to):\n\n-   **Completely Randomized Design (CRD)**: Experimental units are randomly assigned to different treatment groups without any restrictions. This design is suitable when experimental units are homogeneous.\n\n-   **Randomized Block Design (RBD)**: Experimental units are grouped into blocks based on certain characteristics, and treatments are randomly assigned within each block. This design helps control for variability among experimental units.\n\n-   **Factorial Design**: Multiple factors are investigated simultaneously, with all possible combinations of factor levels included in the experiment. This design allows for the study of main effects and interactions between factors.\n\n---\n\n# Factorial Treatment Structure\n\nFactorial treatment structures involve experiments where there are two or more treatment factors, each with two or more levels. In these designs, all possible combinations of the levels of each factor are included in the experiment. For example, in a 2-way factorial design with factors A and B, where factor A has 2 levels (A1 and A2) and factor B has 3 levels (B1, B2, and B3), the treatment combinations would be A1B1, A1B2, A1B3, A2B1, A2B2, and A2B3.\n\n![Factorial designs have more than one treatment or factor. For each treatment there are two or more levels.](images/Slide3.PNG)\n\n## Main Effects and Interactions\n\nIn a factorial design, the **main effects** refer to the individual effects of each treatment/factor on the response variable, while **interactions** refer to the combined effects of two or more treatments/factors on the response variable. An interaction occurs when the effect of one treatment/factor depends on the level of another treatment/factor.\n\nLet's plot some examples of interaction plots:\n\n-   No interaction\n-   Positive interaction\n-   Negative interaction\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\n# No interaction\nno_interaction <- data.frame(\n  FactorA = rep(c(\"A1\", \"A2\"), each = 3),\n  FactorB = rep(c(\"B1\", \"B2\", \"B3\"), times = 2),\n  Response = c(5, 10, 15, 7, 12, 17)\n)\n\nggplot(no_interaction, aes(x = FactorB, y = Response, color = FactorA, group = FactorA)) +\n  geom_point() +\n  geom_line() +\n  labs(title = \"No Interaction\")\n```\n\n::: {.cell-output-display}\n![](tutorial06_files/figure-typst/unnamed-chunk-1-1.png)\n:::\n\n```{.r .cell-code}\n# Positive interaction\npositive_interaction <- data.frame(\n  FactorA = rep(c(\"A1\", \"A2\"), each = 3),\n  FactorB = rep(c(\"B1\", \"B2\", \"B3\"), times = 2),\n  Response = c(5, 10, 15, 10, 20, 30)\n)\n\nggplot(positive_interaction, aes(x = FactorB, y = Response, color = FactorA, group = FactorA)) +\n  geom_point() +\n  geom_line() +\n  labs(title = \"Positive Interaction\")\n```\n\n::: {.cell-output-display}\n![](tutorial06_files/figure-typst/unnamed-chunk-1-2.png)\n:::\n\n```{.r .cell-code}\n# Negative interaction\nnegative_interaction <- data.frame(\n  FactorA = rep(c(\"A1\", \"A2\"), each = 3),\n  FactorB = rep(c(\"B1\", \"B2\", \"B3\"), times = 2),\n  Response = c(15, 10, 5, 5, 10, 15)\n)\n\nggplot(negative_interaction, aes(x = FactorB, y = Response, color = FactorA, group = FactorA)) +\n  geom_point() +\n  geom_line() +\n  labs(title = \"Negative Interaction\")\n```\n\n::: {.cell-output-display}\n![](tutorial06_files/figure-typst/unnamed-chunk-1-3.png)\n:::\n:::\n\n\nThe plots above illustrate different types of interactions between two factors:\n\n- In the **\"No Interaction\"** plot, the lines are parallel, indicating that the effect of one factor does not depend on the level of the other factor.\n- In the **\"Positive Interaction\"** plot, the lines diverge, indicating that the effect of one factor increases with the level of the other factor.\n- In the **\"Negative Interaction\"** plot, the lines converge, indicating that the effect of one factor decreases with the level of the other factor.\n\n::: callout-tip\n## Interpreting Interaction Plots\n\n-   Parallel lines indicate **no interaction** between factors.\n-   Non-parallel lines indicate an **interaction** between factors.\n:::\n\n## Exercise 1: Identifying Main Effects and Interactions\n\nIn this ecological experiment, we investigated the influence of two factors: Fire and Rainfall on small mammal captures (using a 2-way factorial design).\n\nOur main effects are:\n\n-   Effect of Fire (Levels: Burnt, Unburnt)\n-   Effect of Rainfall (Levels: Low, Medium, High)\n\nOur interaction is:\n\n-   Interaction between Fire and Rainfall\n\nLet's simulate some data and plot the main effects and interactions:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nfire <- rep(c(\"Burnt\", \"Unburnt\"), each = 30)\nrainfall <- rep(c(\"Low\", \"Medium\", \"High\"), times = 20)\ncaptures <- rnorm(60, mean = ifelse(fire == \"Burnt\",\n                                    ifelse(rainfall == \"Low\", 5,\n                                           ifelse(rainfall == \"Medium\", 10, 15)),\n                                    ifelse(rainfall == \"Low\", 10,\n                                           ifelse(rainfall == \"Medium\", 15, 20))), sd = 3)\n\ndata <- data.frame(Fire = fire, Rainfall = rainfall, Captures = captures)\n\n# Add level order for plotting\ndata$Rainfall <- factor(data$Rainfall, levels = c(\"Low\", \"Medium\", \"High\"))\n\nlibrary(ggplot2)\n\n# Plot main effect: Rainfall\nggplot(data, aes(x = Rainfall, y = Captures)) +\n  stat_summary(fun = mean, geom = \"bar\", aes(group = 1)) +\n  stat_summary(fun.data = mean_se, geom = \"errorbar\", width = 0.2) +\n  labs(title = \"Main Effect of Rainfall on Small Mammal Captures\")\n```\n\n::: {.cell-output-display}\n![](tutorial06_files/figure-typst/unnamed-chunk-2-1.png)\n:::\n\n```{.r .cell-code}\n# Plot main effect: Fire\nggplot(data, aes(x = Fire, y = Captures)) +\n  stat_summary(fun = mean, geom = \"bar\", aes(group = 1)) +\n  stat_summary(fun.data = mean_se, geom = \"errorbar\", width = 0.2) +\n  labs(title = \"Main Effect of Fire on Small Mammal Captures\")\n```\n\n::: {.cell-output-display}\n![](tutorial06_files/figure-typst/unnamed-chunk-2-2.png)\n:::\n\n```{.r .cell-code}\n# Plot interaction\nggplot(data, aes(x = Rainfall, y = Captures, color = Fire, group = Fire)) +\n  stat_summary(fun = mean, geom = \"point\") +\n  stat_summary(fun = mean, geom = \"line\") +\n  stat_summary(fun.data = mean_se, geom = \"errorbar\", width = 0.2) +\n  labs(title = \"Interaction between Fire and Rainfall on Small Mammal Captures\")\n```\n\n::: {.cell-output-display}\n![](tutorial06_files/figure-typst/unnamed-chunk-2-3.png)\n:::\n:::\n\n\n::: callout-tip\n## Key concepts\n\n-   Main effects represent the individual impact of each factor on the response variable.\n-   Interactions occur when the effect of one factor depends on the level of another factor.\n-   **If an interaction is significant, do not interpret the main effects on their own.**\n-   Read a factorial ANOVA table from the bottom up: interaction terms first, then main effects.\n\nYou must understand these concepts to correctly interpret the results of factorial experiments.\n:::\n\n## Exercise 2: ANOVA using a Factorial Treatment Design\n\nNow that we have visualised the main effects and interaction, we can fit an ANOVA model to test for the significance of these effects.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit ANOVA model\ndata$Fire <- as.factor(data$Fire)\ndata$Rainfall <- as.factor(data$Rainfall) \n\nanova_model <- aov(Captures ~ Fire * Rainfall, data = data)\n\n# Summary of ANOVA model\nsummary(anova_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              Df Sum Sq Mean Sq F value   Pr(>F)    \nFire           1  483.3   483.3  63.117 1.21e-10 ***\nRainfall       2 1030.1   515.0  67.259 2.19e-15 ***\nFire:Rainfall  2   16.5     8.3   1.078    0.347    \nResiduals     54  413.5     7.7                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n> Which effects are significant? Are they main effects and/or interactions? Are they consistent with the plots above?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your answers here and check with teaching staff\n```\n:::\n\n\n---\n\n# Factorial Design with Blocking\n\nA factorial design with blocking is an experimental design that combines the principles of factorial treatment structures with blocking techniques to control for variability in experimental units. Blocking is used to group similar experimental units together, reducing the impact of confounding variables and improving the precision of the experiment.\n\n![Factorial design with blocking. Factorial designs have more than one treatment or factor. For each treatment there are two or more levels. The experimental units are grouped into blocks based on known sources of variation, and treatments are randomly assigned within each block.](images/Slide4.PNG)\n\nThese designs have main effects and interactions as before, but also have blocking effects. You need to be able to identify these in the ANOVA table and plots.\n\n## Exercise 3: Factorial Design with Blocking\n\n### 3.1) ANOVA with Blocking\n\nIn this exercise, we will simulate data for a factorial design with blocking. We will investigate the effects of two factors: Fertilizer (Levels: A, B) and Irrigation (Levels: Low, High) on crop yield, while blocking by Field (Levels: 1, 2, 3).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(456)\nfield <- rep(c(\"Field1\", \"Field2\", \"Field3\"), each = 20)\nfertilizer <- rep(c(\"A\", \"B\"), times = 30)\nirrigation <- rep(c(\"Low\", \"High\"), each = 10, times = 3)\nyield <- rnorm(60, mean = ifelse(fertilizer == \"A\",\n                                 ifelse(irrigation == \"Low\", 30, 40),\n                                 ifelse(irrigation == \"Low\", 35, 45)) +\n                  ifelse(field == \"Field1\", 5,\n                         ifelse(field == \"Field2\", 0, -5)), sd = 4)\n\ndata_blocked <- data.frame(Field = field, Fertilizer = fertilizer,\n                           Irrigation = irrigation, Yield = yield)\n\n# Add level order for plotting\ndata_blocked$Irrigation <- factor(data_blocked$Irrigation, levels = c(\"Low\", \"High\"))\ndata_blocked$Field <- as.factor(data_blocked$Field)\ndata_blocked$Fertilizer <- as.factor(data_blocked$Fertilizer)\ndata_blocked$Irrigation <- as.factor(data_blocked$Irrigation)\n\n# Fit ANOVA model with blocking\nanova_blocked_model <- aov(Yield ~ Field + Fertilizer * Irrigation, data = data_blocked)\n\n# Summary of ANOVA model\nsummary(anova_blocked_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                      Df Sum Sq Mean Sq F value   Pr(>F)    \nField                  2 1208.9   604.4  43.669 5.22e-12 ***\nFertilizer             1  631.5   631.5  45.625 1.03e-08 ***\nIrrigation             1 2003.0  2003.0 144.711  < 2e-16 ***\nFertilizer:Irrigation  1   40.1    40.1   2.899   0.0944 .  \nResiduals             54  747.4    13.8                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n> Which effects are significant? Are they main effects, interactions, or blocking effects?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your answers here and check with teaching staff\n```\n:::\n\n\n### 3.2) Visualising Factorial Design with Blocking\n\nNow let's visualise the effects in this blocked factorial design using the `emmeans` package and its plotting functions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(emmeans)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWelcome to emmeans.\nCaution: You lose important information if you filter this package's results.\nSee '? untidy'\n```\n\n\n:::\n\n```{.r .cell-code}\n# Calculate estimated marginal means\nemm <- emmeans(anova_blocked_model, ~ Fertilizer * Irrigation)\n\n# Main effect plots using emmeans\nplot(emmeans(anova_blocked_model, ~ Fertilizer), \n     main = \"Main Effect of Fertilizer on Crop Yield\", comparisons = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNOTE: Results may be misleading due to involvement in interactions\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](tutorial06_files/figure-typst/unnamed-chunk-7-1.png)\n:::\n\n```{.r .cell-code}\nplot(emmeans(anova_blocked_model, ~ Irrigation), \n     main = \"Main Effect of Irrigation on Crop Yield\", comparisons = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNOTE: Results may be misleading due to involvement in interactions\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](tutorial06_files/figure-typst/unnamed-chunk-7-2.png)\n:::\n\n```{.r .cell-code}\n# Blocking effect plot using emmeans\nplot(emmeans(anova_blocked_model, ~ Field), \n     main = \"Blocking Effect of Field on Crop Yield\", comparisons = TRUE)\n```\n\n::: {.cell-output-display}\n![](tutorial06_files/figure-typst/unnamed-chunk-7-3.png)\n:::\n\n```{.r .cell-code}\n# Interaction plot using emmeans\nemmip(anova_blocked_model, Fertilizer ~ Irrigation,\n      main = \"Interaction between Fertilizer and Irrigation on Crop Yield\", CIs = TRUE)\n```\n\n::: {.cell-output-display}\n![](tutorial06_files/figure-typst/unnamed-chunk-7-4.png)\n:::\n:::\n\n\n> Describe the main effects and interaction effects observed in the plots above. How do these visualisations help in understanding the effects of Fertilizer and Irrigation on crop yield?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your answers here and check with teaching staff\n```\n:::\n\n\nNote: We usually don't plot blocking effects as they are not of primary interest, but it can be useful to check for large differences between blocks.\n\nDepending on our hypotheses, we may be interested in post-hoc tests for the main effects or interaction effects. If there is a significant interaction, we should focus on that rather than the main effects. We may not need to use all the plots. Always let your hypotheses guide what plots to produce.\n\n### 3.3) Calculate the variance explained by each effect\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate variance explained by each effect\nanova_summary <- summary(anova_blocked_model)\nss_total <- sum(anova_summary[[1]][, \"Sum Sq\"])\nss_effects <- anova_summary[[1]][, \"Sum Sq\"]\n\nvariance_explained <- (ss_effects / ss_total) * 100\n\nanova_summary # ANOVA table\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                      Df Sum Sq Mean Sq F value   Pr(>F)    \nField                  2 1208.9   604.4  43.669 5.22e-12 ***\nFertilizer             1  631.5   631.5  45.625 1.03e-08 ***\nIrrigation             1 2003.0  2003.0 144.711  < 2e-16 ***\nFertilizer:Irrigation  1   40.1    40.1   2.899   0.0944 .  \nResiduals             54  747.4    13.8                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nvariance_explained # variation explained by each effect in order of the ANOVA table from top to bottom\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 26.1042461 13.6367542 43.2524207  0.8665808 16.1399983\n```\n\n\n:::\n:::\n\n\n> Which effect explains the most variance in crop yield? How does this information help in understanding the factors influencing crop yield?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your answers here and check with teaching staff\n```\n:::\n\n\n---\n\n# Summary\n\nIn this tutorial, we explored factorial designs and their analysis using ANOVA. We learned about main effects, interactions, and blocking effects, and how to interpret ANOVA results in the context of factorial experiments. We also visualised these effects using ggplot2 and emmeans, enhancing our understanding of the relationships between factors and response variables in experimental designs.\n\n## Example exam questions\n\n1.  In a 2-way factorial design with factors A (2 levels) and B (3 levels), describe how you would identify and interpret main effects and interactions using ANOVA. Provide an example of how to visualise these effects.\n\n2.  Explain the difference between a treatment design and an experimental design. Provide examples of each and discuss how they can be combined in a factorial design with blocking.\n\n3.  If you conducted a factorial experiment with blocking and found a significant interaction between two factors, how would you interpret this result? Would you still consider the main effects of each factor? Justify your answer with reference to ANOVA principles.\n",
    "supporting": [
      "tutorial06_files/figure-typst"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}