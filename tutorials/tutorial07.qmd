---
title: "Tutorial 07"
# reviewed-by: ACA, 2026
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## Bird abundance

This is the *same* dataset used in the lecture.

Fragmentation of forest habitat has an impact of wildlife abundance. This study looked at the relationship between bird abundance (bird ha^-1^) and the characteristics of forest patches at 56 locations in SE Victoria.

The predictor variables are:

-   `ALT` Altitude (m)
-   `YR.ISOL` Year when the patch was isolated (years)
-   `GRAZE` Grazing (coded 1-5 which is light to heavy)
-   `AREA` Patch area (ha)
-   `DIST` Distance to nearest patch (km)
-   `LDIST` Distance to largest patch (km)

Import the data from the "Loyn" tab in the MS Excel file.

```{r}
library(readxl)
loyn <- read_xlsx("mlr.xlsx", "Loyn")
```

Often, the first step in model development is to examine the data. This is a good way to get a feel for the data and to identify any issues that may need to be addressed. In this case, we will examine the data using histograms and a correlation matrix.

### Histograms

There are a breadth of ways to create histograms in R. In each tab below you will find some different ways to create the same plot outputs.

::: panel-tabset
### `hist()`

This is a straightforward way to create multiple histograms with `hist()`. The `par()` function is used to arrange the plots on the page. The `mfrow` argument specifies the number of rows and columns of plots.

```{r}
# par(mfrow=c(3,3))
hist(loyn$ABUND)
hist(loyn$ALT)
hist(loyn$YR.ISOL)
hist(loyn$GRAZE)
hist(loyn$AREA)
hist(loyn$DIST)
hist(loyn$LDIST)
# par(mfrow=c(1,1))
```

### `hist.data.frame()` from `Hmisc`

The `Hmisc` package provides a function `hist.data.frame()` that can be used to create multiple histograms, which can be called by simply using `hist()`. You may need to tweak the `nclass` argument to get the desired number of bins, as the default may not look appropriate.

```{r eval=FALSE}
#| message: false
# install.packages("Hmisc")
library(Hmisc)
hist(loyn, nclass = 50)
```

### `ggplot()`

A more modern approach is to use `ggplot()` with `facet_wrap()` to arrange multiple plots on a single page. To do this, the `pivot_longer()` function from the `tidyr` package is used to reshape the data into a tidy format.

```{r}
#| message: false
# tidy the data
loyn_tidy <- pivot_longer(loyn, cols = everything())

# plot
ggplot(loyn_tidy, aes(x = value)) +
    geom_histogram() +
    facet_wrap(~name, scales = "free") +
    theme_bw()
```

### `ggplot()` with `dplyr`

Here we use the pipe operator `%>%` from `dplyr` to chain together a series of commands. The pipe operator takes the output of the command on the left and passes it to the command on the right (or below) the pipe. This means that we can create a series of commands that are executed in order.

```{r}
#| message: false
loyn %>%
    pivot_longer(cols = everything()) %>%
    ggplot(aes(x = value)) +
    geom_histogram() +
    facet_wrap(~name, scales = "free") +
    theme_bw()
```
:::

::: question
### Question 1

Comment on the histograms in terms of leverage. *Hint: what is the relationship between leverage and skewness?*
:::

::: {.content-visible when-profile="solution"}
### Answer {style="color:green;"}

The histograms of `AREA`, `DIST` and `LDIST` are very skewed. The high values would have high leverage, this means that these would cause the residuals to be skewed. These would be candidates for transformation.
:::

### Correlation matrix

Calculate the correlation matrix using `cor(Loyn)`.

```{r}
cor(loyn)
```

::: question
### Question 2

Which independent variables are useful for predicting the dependent variable abundance? Is there evidence for multi-collinearity?
:::

```{r corLoyn, eval=F, echo=F}
cor(loyn)
```

::: {.content-visible when-profile="solution"}
### Answer {style="color:green;"}

Some of the predictors are useful, but AREA has a low r.

The correlation between `GRAZE` and `YR.ISOL` is quite high (r = -0.63556710), suggesting multi-collinearity which may influence the model. If the relationship between these two variables was stronger, we would remove one of the variables to prevent this collinearity from affecting the model.

*Note: For more information on collinearity and how it may impact the model, see Quinn & Keough p 127.*
:::

### Plotting correlation

Examine correlations visually using `pairs()` or `corrplot()` from the `corrplot` package.

::: panel-tabset
### Scatterplot matrix

```{r}
pairs(loyn)
```

### Correlation matrix

```{r}
#| message: false
library(corrplot)
corrplot(cor(loyn))
```
:::

::: question
### Question 3

Are there any trends visible from the plots?
:::

::: {.content-visible when-profile="solution"}
### Answer {style="color:green;"}

Not really; the pairs plot reflects the strength of the linear relationship between each of the variables. There may be some stronger relationships occurring, but it is evident a few of the variables are skewed so it is harder to distinguish within the plots.
:::

::: callout-tip
We can also bring in variance inflation factors (VIF) to help us identify multi-collinearity, but that is done only after we have selected a model.
:::

### Transformations

The AREA predictor has a small number of observations with very large values. Apply a log~10~ transformation and label the new variable `Loyn$L10AREA`.

```{r}
#| eval: false
loyn$L10AREA <- log10(loyn$AREA)
```

::: question
### Question 4

Why are we transforming AREA?
:::

::: {.content-visible when-profile="solution"}
### Answer {style="color:green;"}

You do this to stabilise the variance of the regression to manage the leverage of the outliers in the variable. This reduces the skew. L10AREA is more likely to be a significant predictor.
:::

::: question
### Question 5

Re-run `pairs(Loyn)` and create a histogram using the transformed value of AREA, how do the plots look?
:::

```{r}
#| eval: false
hist(loyn$L10AREA)
pairs(loyn)
```

::: {.content-visible when-profile="solution"}
### Answer {style="color:green;"}

-   Histogram looks better, less skewed
-   Pairs plot shows a trend between ABUND and L10AREA
:::

::: question
### Question 6

In preparation for modelling, transform the remaining skewed variables, DIST and LDIST the same way you did for AREA and examine the histogram and pairs plots using these new variables.
:::

Make sure you end up with two new variables labelled `loyn$L10DIST` and `loyn$L10LDIST`.

```{r}
#| eval: false
#| include: false
loyn$L10DIST <- log10(loyn$DIST)
hist(loyn$L10DIST)

loyn$L10LDIST <- log10(loyn$LDIST)
hist(loyn$L10LDIST)

pairs(loyn)
```

::: {.content-visible when-profile="solution"}
### Answer {style="color:green;"}

Histogram for both look better, less skewed Pairs plot shows potential trend between ABUND and L10DIST, and ABUND with L10LDIST compared to untransformed DIST and LDIST
:::